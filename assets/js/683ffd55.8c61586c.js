"use strict";(self.webpackChunkdocusaurus_project=self.webpackChunkdocusaurus_project||[]).push([[34],{8212(e,n,s){s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>a,default:()=>c,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"Subqueries","title":"Subqueries","description":"Learning Objectives","source":"@site/docs/Subqueries.md","sourceDirName":".","slug":"/Subqueries","permalink":"/backend-tools-handbook/Subqueries","draft":false,"unlisted":false,"editUrl":"https://github.com/pragnakalp/backend-tools-handbook/tree/main/docs/Subqueries.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"07 Modifying Data","permalink":"/backend-tools-handbook/Modifying-Data"},"next":{"title":"09 Data Types","permalink":"/backend-tools-handbook/Data-Types"}}');var i=s(4848),l=s(8453);const t={},a="Subqueries",h={},o=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"What is a Subquery?",id:"what-is-a-subquery",level:2},{value:"Definition",id:"definition",level:3},{value:"Why use it?",id:"why-use-it",level:3},{value:"Syntax",id:"syntax",level:3},{value:"Basic Subquery",id:"basic-subquery",level:2},{value:"Example: Films in Action Category",id:"example-films-in-action-category",level:3},{value:"Subquery Types",id:"subquery-types",level:2},{value:"1. Non-Correlated Subquery",id:"1-non-correlated-subquery",level:3},{value:"2. Correlated Subquery",id:"2-correlated-subquery",level:3},{value:"Subquery with IN Operator",id:"subquery-with-in-operator",level:2},{value:"What is it?",id:"what-is-it",level:3},{value:"Why use it?",id:"why-use-it-1",level:3},{value:"Example: Customers Who Rented Action Films",id:"example-customers-who-rented-action-films",level:3},{value:"ANY Operator",id:"any-operator",level:2},{value:"What is it?",id:"what-is-it-1",level:3},{value:"Why use it?",id:"why-use-it-2",level:3},{value:"Syntax",id:"syntax-1",level:3},{value:"Example: Films Longer Than Any Film in a Rating",id:"example-films-longer-than-any-film-in-a-rating",level:3},{value:"ALL Operator",id:"all-operator",level:2},{value:"What is it?",id:"what-is-it-2",level:3},{value:"Why use it?",id:"why-use-it-3",level:3},{value:"Syntax",id:"syntax-2",level:3},{value:"Example: Films Longer Than All Films in a Rating",id:"example-films-longer-than-all-films-in-a-rating",level:3},{value:"EXISTS Operator",id:"exists-operator",level:2},{value:"What is it?",id:"what-is-it-3",level:3},{value:"Why use it?",id:"why-use-it-4",level:3},{value:"Syntax",id:"syntax-3",level:3},{value:"Example: Check if Any Zero Payments Exist",id:"example-check-if-any-zero-payments-exist",level:3},{value:"Example: Customers Who Made High Payments",id:"example-customers-who-made-high-payments",level:3},{value:"EXISTS vs. IN",id:"exists-vs-in",level:3},{value:"Practice Exercises",id:"practice-exercises",level:2},{value:"Solutions",id:"solutions",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"subqueries",children:"Subqueries"})}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this module, you will be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Write subqueries (nested queries)"}),"\n",(0,i.jsx)(n.li,{children:"Understand correlated vs. non-correlated subqueries"}),"\n",(0,i.jsx)(n.li,{children:"Use subqueries with IN, ANY, and ALL operators"}),"\n",(0,i.jsx)(n.li,{children:"Use EXISTS to check for row existence"}),"\n",(0,i.jsx)(n.li,{children:"Apply subqueries in WHERE, FROM, and SELECT clauses"}),"\n",(0,i.jsx)(n.li,{children:"Solve complex problems with nested queries"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-is-a-subquery",children:"What is a Subquery?"}),"\n",(0,i.jsx)(n.h3,{id:"definition",children:"Definition"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"subquery"})," (also called an inner query) is a query nested inside another query. The subquery is always enclosed within parentheses and is executed first, providing its result to the main (outer) query."]}),"\n",(0,i.jsx)(n.h3,{id:"why-use-it",children:"Why use it?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Break complex problems into smaller parts"}),"\n",(0,i.jsx)(n.li,{children:"Use results from one query as input for another"}),"\n",(0,i.jsx)(n.li,{children:"Filter data based on conditions from other tables"}),"\n",(0,i.jsx)(n.li,{children:"Perform multi-step lookups in a single statement"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT column_name(s) \nFROM table_name \nWHERE column_name (operator) (SELECT column_name FROM table_name WHERE condition);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Think of it like this"}),": A subquery is like asking a question to answer another question. First, you find something (subquery), then you use that result in your main query."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"basic-subquery",children:"Basic Subquery"}),"\n",(0,i.jsx)(n.h3,{id:"example-films-in-action-category",children:"Example: Films in Action Category"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT film_id, title \nFROM film \nWHERE film_id IN (\n    SELECT film_id \n    FROM film_category \n    INNER JOIN category USING (category_id) \n    WHERE name = 'Action'\n) \nORDER BY film_id;\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"How it works"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inner query"})," executes first: Finds all film_ids in the Action category"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Outer query"})," uses those IDs: Selects films matching those IDs"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output"}),": All films in the Action category."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"subquery-types",children:"Subquery Types"}),"\n",(0,i.jsx)(n.h3,{id:"1-non-correlated-subquery",children:"1. Non-Correlated Subquery"}),"\n",(0,i.jsx)(n.p,{children:"The inner query is independent and executes once before the outer query."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT title, rental_rate \nFROM film \nWHERE rental_rate > (\n    SELECT AVG(rental_rate) \n    FROM film\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Process"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Inner query calculates average rental rate (runs once)"}),"\n",(0,i.jsx)(n.li,{children:"Outer query finds films with rate higher than that average"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:'Why it\'s called "non-correlated"'}),": The inner query doesn't depend on the outer query - it runs once and gives a single result."]}),"\n",(0,i.jsx)(n.h3,{id:"2-correlated-subquery",children:"2. Correlated Subquery"}),"\n",(0,i.jsx)(n.p,{children:"The inner query refers to columns from the outer query and is re-evaluated for each row."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT film_id, title, length, rating \nFROM film f \nWHERE length > (\n    SELECT AVG(length) \n    FROM film \n    WHERE rating = f.rating\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Process"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"For each film in the outer query"}),"\n",(0,i.jsx)(n.li,{children:"Inner query calculates average length for that film's rating"}),"\n",(0,i.jsx)(n.li,{children:"Compares the film's length to that average"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output"}),": Films longer than the average for their specific rating."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:'Why it\'s called "correlated"'}),": The inner query correlates with (depends on) each row of the outer query."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"subquery-with-in-operator",children:"Subquery with IN Operator"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-it",children:"What is it?"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"IN"})," with a subquery to check if a value exists in the subquery's result set."]}),"\n",(0,i.jsx)(n.h3,{id:"why-use-it-1",children:"Why use it?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check if a value exists in another table"}),"\n",(0,i.jsx)(n.li,{children:"Filter based on results from another query"}),"\n",(0,i.jsx)(n.li,{children:"More flexible than hardcoding a list"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-customers-who-rented-action-films",children:"Example: Customers Who Rented Action Films"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT DISTINCT customer_id, first_name, last_name \nFROM customer \nWHERE customer_id IN (\n    SELECT DISTINCT r.customer_id \n    FROM rental r\n    INNER JOIN inventory i ON r.inventory_id = i.inventory_id\n    INNER JOIN film_category fc ON i.film_id = fc.film_id\n    INNER JOIN category c ON fc.category_id = c.category_id\n    WHERE c.name = 'Action'\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output"}),": Customers who have rented at least one Action film."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"any-operator",children:"ANY Operator"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-it-1",children:"What is it?"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ANY"})," operator compares a single value against a set of values returned by a subquery. The condition is true if ",(0,i.jsx)(n.strong,{children:"at least one value"})," satisfies the comparison."]}),"\n",(0,i.jsx)(n.h3,{id:"why-use-it-2",children:"Why use it?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check if a value meets any condition in a set"}),"\n",(0,i.jsx)(n.li,{children:"More flexible than IN (works with comparison operators like >, <)"}),"\n",(0,i.jsx)(n.li,{children:"Useful for range comparisons"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"syntax-1",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"expression operator ANY (subquery)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Operators"}),": ",(0,i.jsx)(n.code,{children:"="}),", ",(0,i.jsx)(n.code,{children:">"}),", ",(0,i.jsx)(n.code,{children:"<"}),", ",(0,i.jsx)(n.code,{children:">="}),", ",(0,i.jsx)(n.code,{children:"<="}),", ",(0,i.jsx)(n.code,{children:"<>"})]}),"\n",(0,i.jsx)(n.h3,{id:"example-films-longer-than-any-film-in-a-rating",children:"Example: Films Longer Than Any Film in a Rating"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT film_id, title, length, rating \nFROM film f \nWHERE length > ANY (\n    SELECT AVG(length) \n    FROM film \n    WHERE rating = f.rating\n) \nLIMIT 15;\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output"}),": Films longer than at least one average length for their rating category."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"all-operator",children:"ALL Operator"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-it-2",children:"What is it?"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ALL"})," operator compares a value against ",(0,i.jsx)(n.strong,{children:"every value"})," in a result set returned by a subquery. It returns true only if the comparison holds for ",(0,i.jsx)(n.strong,{children:"all values"})," in the set."]}),"\n",(0,i.jsx)(n.h3,{id:"why-use-it-3",children:"Why use it?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check if a value meets all conditions"}),"\n",(0,i.jsx)(n.li,{children:"Stricter than ANY"}),"\n",(0,i.jsx)(n.li,{children:'Useful for "greater than all" or "less than all" scenarios'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"syntax-2",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"expression operator ALL (subquery)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-films-longer-than-all-films-in-a-rating",children:"Example: Films Longer Than All Films in a Rating"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT film_id, title, length, rating \nFROM film f \nWHERE length > ALL (\n    SELECT length \n    FROM film \n    WHERE rating = f.rating AND film_id != f.film_id\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output"}),": Films longer than all other films in their rating category."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": This is stricter than ANY - the film must be longer than every other film in its rating."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"exists-operator",children:"EXISTS Operator"}),"\n",(0,i.jsx)(n.h3,{id:"what-is-it-3",children:"What is it?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"EXISTS"})," is a boolean operator that checks if a subquery returns ",(0,i.jsx)(n.strong,{children:"any rows"}),". It returns ",(0,i.jsx)(n.code,{children:"true"})," as soon as it finds at least one matching row; otherwise, it returns ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"why-use-it-4",children:"Why use it?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check for existence of related records"}),"\n",(0,i.jsx)(n.li,{children:"Often more efficient than IN for large datasets"}),"\n",(0,i.jsx)(n.li,{children:'Useful for "has at least one" scenarios'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"syntax-3",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"EXISTS (subquery)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-check-if-any-zero-payments-exist",children:"Example: Check if Any Zero Payments Exist"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT EXISTS (\n    SELECT 1 \n    FROM payment \n    WHERE amount = 0\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output"}),": Returns ",(0,i.jsx)(n.code,{children:"true"})," if any payment has amount 0, ",(0,i.jsx)(n.code,{children:"false"})," otherwise."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note"}),": The ",(0,i.jsx)(n.code,{children:"SELECT 1"})," is just a placeholder - EXISTS only cares if rows exist, not what columns are selected."]}),"\n",(0,i.jsx)(n.h3,{id:"example-customers-who-made-high-payments",children:"Example: Customers Who Made High Payments"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT first_name, last_name \nFROM customer c \nWHERE EXISTS (\n    SELECT 1 \n    FROM payment p \n    WHERE p.customer_id = c.customer_id \n      AND amount > 11\n) \nORDER BY first_name, last_name;\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output"}),": Customers who have made at least one payment greater than $11."]}),"\n",(0,i.jsx)(n.h3,{id:"exists-vs-in",children:"EXISTS vs. IN"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"EXISTS"}),(0,i.jsx)(n.th,{children:"IN"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Stops at first match (faster)"}),(0,i.jsx)(n.td,{children:"Checks all values"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Better for large datasets"}),(0,i.jsx)(n.td,{children:"Better for small lists"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Works with correlated subqueries"}),(0,i.jsx)(n.td,{children:"Usually with non-correlated"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"practice-exercises",children:"Practice Exercises"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Find films with rental rate higher than the average rental rate"}),"\n",(0,i.jsx)(n.li,{children:"Find customers who have made at least one payment (use EXISTS)"}),"\n",(0,i.jsx)(n.li,{children:"Find films longer than the average for their rating (correlated subquery)"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"solutions",children:"Solutions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- 1. Above average\nSELECT title, rental_rate \nFROM film \nWHERE rental_rate > (SELECT AVG(rental_rate) FROM film);\n\n-- 2. Customers with payments\nSELECT customer_id, first_name, last_name \nFROM customer c \nWHERE EXISTS (\n    SELECT 1 FROM payment p \n    WHERE p.customer_id = c.customer_id\n);\n\n-- 3. Correlated subquery\nSELECT film_id, title, length, rating \nFROM film f \nWHERE length > (\n    SELECT AVG(length) \n    FROM film \n    WHERE rating = f.rating\n);\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Subqueries"})," are queries nested inside other queries (enclosed in parentheses)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Non-correlated subqueries"})," execute once before the outer query"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Correlated subqueries"})," reference outer query columns and execute for each row"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"IN"})," checks if a value exists in subquery results"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ANY"})," returns true if comparison matches at least one value"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ALL"})," returns true only if comparison matches all values"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"EXISTS"})," checks if subquery returns any rows (often more efficient than IN)"]}),"\n",(0,i.jsx)(n.li,{children:"Subqueries help break complex problems into manageable parts"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Next Module"}),": ",(0,i.jsx)(n.a,{href:"/backend-tools-handbook/Data-Types",children:"Data-Types.md"})," - Learn about PostgreSQL data types"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Excellent! You can now write powerful nested queries!"})," \ud83c\udf89"]})]})}function c(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>a});var r=s(6540);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);